<story-context id="bmad/bmm/workflows/4-implementation/story-context/template" v="1.0">
  <metadata>
    <epicId>1</epicId>
    <storyId>1</storyId>
    <title>Initialize Monorepo with Next.js and TypeScript</title>
    <status>Approved</status>
    <generatedAt>2025-11-06</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>docs/stories/1-1-initialize-monorepo-with-next-js-and-typescript.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>developer</asA>
    <iWant>a properly structured monorepo with Next.js, TypeScript, and core tooling configured</iWant>
    <soThat>the team has a consistent, scalable foundation for building all features</soThat>
    <tasks><![CDATA[
Task 1: Initialize base Next.js project (AC: #1, #2)
- Run pnpm create next-app@latest friends-dictation --typescript --tailwind --eslint --app --src-dir --import-alias "@/*"
- Verify Next.js 15 and TypeScript 5.x are installed
- Confirm App Router structure is created in src/app

Task 2: Convert to monorepo structure (AC: #1, #3)
- Move Next.js app from root to apps/web directory
- Create pnpm-workspace.yaml with workspace configuration
- Create packages/shared directory with package.json and tsconfig.json
- Create packages/database directory with package.json
- Update root package.json with workspace scripts

Task 3: Configure TypeScript for monorepo (AC: #6)
- Create root tsconfig.json with base configuration
- Update apps/web/tsconfig.json to extend root config
- Configure path aliases for cross-package imports
- Set up packages/shared/tsconfig.json for shared types
- Verify TypeScript compilation works across packages

Task 4: Set up development tooling (AC: #4)
- Configure ESLint for monorepo with shared rules
- Set up Prettier with .prettierrc configuration
- Add .prettierignore and .eslintignore files
- Create .env.example with required environment variables
- Add format and lint scripts to root package.json

Task 5: Install core dependencies (AC: #2, #5)
- Run dependency installation commands from architecture.md
- Add NextAuth.js, Prisma, Zustand, TanStack Query
- Add react-player and other UI dependencies
- Verify all dependencies are correctly installed
- Check for any peer dependency warnings

Task 6: Verify development environment (AC: #5)
- Run pnpm dev from apps/web directory
- Confirm server starts on http://localhost:3000
- Test hot module replacement is working
- Verify TypeScript compilation in watch mode
- Check that Tailwind CSS is processing styles

Task 7: Create initial documentation (AC: #1)
- Create README.md with setup instructions
- Document monorepo structure and conventions
- Add development workflow documentation
- Include pnpm workspace commands reference
    ]]></tasks>
  </story>

  <acceptanceCriteria><![CDATA[
1. Given a new project repository, When the initial setup is complete, Then the monorepo structure exists with pnpm workspaces configured
2. Given the monorepo structure, When checking the apps directory, Then Next.js 15 is installed in apps/web with TypeScript 5.x configured
3. Given the monorepo structure, When checking the packages directory, Then shared and database folders exist for common types and utilities
4. Given the development environment, When running code quality checks, Then ESLint and Prettier are configured and pass without errors
5. Given the completed setup, When running pnpm dev in the apps/web directory, Then the development server starts successfully on localhost:3000
6. Given the project configuration, When checking TypeScript setup, Then path aliases (@/*) are configured and working across the monorepo
  ]]></acceptanceCriteria>

  <artifacts>
    <docs><![CDATA[
- path: docs/architecture.md
  title: Architecture
  section: Project Initialization
  snippet: Defines exact Next.js initialization command and monorepo structure

- path: docs/architecture.md
  title: Architecture
  section: Decision Summary
  snippet: Technology stack decisions including Next.js 15, TypeScript 5.x, pnpm 8.x

- path: docs/architecture.md
  title: Architecture
  section: Project Structure
  snippet: Complete monorepo folder hierarchy with apps/web and packages structure

- path: docs/epics.md
  title: Epic Breakdown
  section: Story 1.1
  snippet: Original story requirements and acceptance criteria

- path: docs/prd.md
  title: Product Requirements Document
  section: Technical Assumptions
  snippet: Monorepo and serverless architecture decisions
    ]]></docs>
    <code><![CDATA[
<!-- No existing code files yet - this is the first story establishing the project -->
    ]]></code>
    <dependencies><![CDATA[
<!-- Dependencies will be installed as part of this story implementation -->
Core dependencies to install:
- next: 15.x
- react: 19.x (Next.js 15 compatible)
- typescript: 5.x
- tailwindcss: 3.4.x
- eslint: latest
- prettier: latest
- next-auth: 4.24.13
- @prisma/client: 5.x
- prisma: 5.x (dev)
- zustand: 4.x
- @tanstack/react-query: 5.x
- react-player: latest
- date-fns: latest
- zod: latest
- @aws-sdk/client-s3: latest
- @types/node: latest (dev)
- vitest: latest (dev)
- @playwright/test: latest (dev)
    ]]></dependencies>
  </artifacts>

  <constraints><![CDATA[
1. Must use pnpm as package manager (not npm or yarn)
2. Must use App Router architecture (not Pages Router)
3. Must create monorepo structure with apps/ and packages/ folders
4. Project must be named "friends-dictation" exactly
5. TypeScript must be configured with strict mode
6. Must include path aliases (@/*) for imports
7. Must use src/ directory structure in Next.js app
8. Must enable Tailwind CSS from initialization
9. ESLint and Prettier must be configured for code quality
10. All packages must be workspace-linked via pnpm
  ]]></constraints>

  <interfaces><![CDATA[
<!-- No existing interfaces yet - this story creates the foundation -->
This story will establish:
- Package interfaces between apps/web and packages/*
- TypeScript configuration interfaces
- Build scripts and development commands
  ]]></interfaces>

  <tests>
    <standards><![CDATA[
Testing framework: Vitest for unit tests, Playwright for E2E tests. Tests should be placed in tests/ directory at root level with unit/ and e2e/ subdirectories. All critical functionality must have test coverage. Use test-driven development where practical.
    ]]></standards>
    <locations><![CDATA[
- tests/unit/  (unit tests)
- tests/e2e/   (end-to-end tests)
- Individual component tests may be colocated with components as *.test.ts files
    ]]></locations>
    <ideas><![CDATA[
AC#1: Test that pnpm-workspace.yaml exists and is valid
AC#2: Test that Next.js version is 15.x and TypeScript is 5.x
AC#3: Test that packages/shared and packages/database exist with valid package.json
AC#4: Test that ESLint and Prettier configs exist and lint passes
AC#5: Test that dev server starts and responds on localhost:3000
AC#6: Test that TypeScript path aliases resolve correctly
    ]]></ideas>
  </tests>
</story-context>